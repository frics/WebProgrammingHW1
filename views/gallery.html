{% extends 'layout.html' %}

{% block content %}

  <div class="container" style="margin-top: 60px;" >

    <a id="posting" data-toggle="modal" data-target="#postModal"  class="btn btn-default" style=" float: right; margin-bottom: 10px;">
    업로드
    </a>

    {% for gallery in galleris %}
    <div class="gallery-item">
      <div class="square bg" style="background-image: url('{{gallery.img}}');">
        <div class="gallery-item-info">
          <div class="gallery-item-likes">
            <h1 class="visually-hidden">BY {{gallery.writer}}</h1>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}

  </div>


  <div id="postModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
      <div class="row">
        <div class="col-md-8 col-md-offset-2">
          <div class="modal-content">
        
            <div class="modal-header ">
              <button type="button" class="close" data-dismiss="modal"> &times;</button>
              <h4>글쓰기</h4>
            </div>
            <div class="modal-body">
              
              <form id="upload-form" action="/gallery" method="post" enctype="multipart/form-data">
                <div class="img-preview">
                  <img id="img-preview" src="" style="display: none;" width="100%" alt="미리보기">
                  <input id="img-url" type="hidden" name="url">
                 
                  <input id="img" type="file" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="description">내용</label>
                    <textarea id="content" style="resize:none;" rows="5" class="form-control" name="content" ></textarea>
                </div>
                <div class="form-group">
                    <p><span class="require">*</span> - 필수입니다</p>
                </div>
                <div>
                  <button type="submit" class="btn btn-info btn-xs">등록</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
{% endblock %}

{% block script %}
  <script>
    if (document.getElementById('img')) {
      document.getElementById('img').addEventListener('change', function(e) {
        const formData = new FormData();
        console.log(this, this.files);
        formData.append('img', this.files[0]);
        console.log('hello');
        axios.post('/gallery/img', formData)
          .then((res) => {
            document.getElementById('img-url').value = res.data.url;
            document.getElementById('img-preview').src = res.data.url;
            document.getElementById('img-preview').style.display = 'inline';
          })
          .catch((err) => {
            console.error(err);
          });
      });
    };


  </script>
{% endblock %}